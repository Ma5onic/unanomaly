<!DOCTYPE html>
<html>
	<head>
		<link rel=stylesheet href="styles/index.css" type="text/css">
		<script type="text/javascript" src="scripts/jquery-1.8.3.js"></script>	
		<script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
		 <link rel="stylesheet" href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" />
		<script>
			$(document).ready(function(){
				
				var pathFile = "";
				
				$( "#slider" ).slider();

				function handleFileSelect(evt) {

					$('#box_drop_zone').toggleClass('box_drop_zone_start_drag');
    				evt.stopPropagation();
    				evt.preventDefault();

    				var files = evt.dataTransfer.files; // FileList object.

    				// files is a FileList of File objects. List some properties.
    				var output = [];
    				for (var i = 0, f; f = files[i]; i++) {
                  		pathFile = escape(f.name);
    				}

    				
  				}

				function handleDragOver(evt) {
					$('#box_drop_zone').toggleClass('box_drop_zone_start_drag');
				    evt.stopPropagation();
				    evt.preventDefault();
				    evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
				}

				// Setup the dnd listeners.
				var dropZone = document.getElementById('drop_zone');
				dropZone.addEventListener('dragover', handleDragOver, false);
				dropZone.addEventListener('drop', handleFileSelect, false);

				$( "#slider" ).slider({
    				change: function( event, ui ) {
    					console.log($( "#slider" ).slider( "value" ));
    				}
				});

				$( "#slider" ).on( "slidechange", function( event, ui ) {
					var sliderValue = $( "#slider" ).slider( "value" );
					sliderValue = (sliderValue / 100000) + 0.00001;
					$.get('http://localhost:8000/compute?file='+pathFile+'&threshold='+sliderValue, function(data) {
 							parseOutliers(data);
						});

				} );

				function parseOutliers(datos){
					$('#tabla_outliers').remove();
					$('#box_tabla_outliers').append('<ul id="tabla_outliers"></ul>');
					var datosJSON = jQuery.parseJSON(datos);
					var lista = datosJSON.Lists;
					for(var i=0;i<lista.length;i++){
						var arrayDatos = lista[i].split(" ");
						var x = arrayDatos[0];
						var y = arrayDatos[1];
						$('#tabla_outliers').append('<li class="data_row_x"><label class="data data_x">'+x+'</label><label class="data data_y">'+y+'</label><li>');	
					}
				};

			});

		</script>
	</head>
	<body>
		<div id="contenedor_principal">
			<div id="contenedor_cuerpo">
				<div id="box_drop_zone">	
					<div id="drop_zone">
						<div id="drop_zone_text">
							Drop your file here
						</div>	
					</div>
				</div>

				<div id="box_seek_bar">
					<div id="slider"></div>
				</div> 

				<div id="box_tabla_outliers">
					<div id="data_column_x" class="data_column">Column X</div>
					<div id="data_column_y" class="data_column">Column Y</div>
				</div>
			</div>	
		</div>	
	</body>	
</html> 